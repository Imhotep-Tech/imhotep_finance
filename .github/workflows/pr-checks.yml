name: PR Checks

on:
  pull_request:
    branches:
      - main

permissions:
  contents: read
  pull-requests: write

jobs:
  pr-title-check:
    runs-on: ubuntu-latest
    
    steps:
      - name: Check PR title format
        run: |
          PR_TITLE="${{ github.event.pull_request.title }}"
          echo "PR Title: $PR_TITLE"
          
          # Check if PR title follows conventional commits format
          if [[ ! "$PR_TITLE" =~ ^(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert)(\(.+\))?:\ .+ ]]; then
            echo "‚ùå PR title does not follow conventional commits format"
            echo "Expected format: type(scope): description"
            echo "Examples:"
            echo "  - feat(accounts): add password reset functionality"
            echo "  - fix(api): resolve authentication bug"
            echo "  - refactor: apply DDD pattern to services"
            exit 1
          fi
          echo "‚úÖ PR title follows conventional commits format"

  size-check:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Check PR size
        run: |
          BASE_SHA=${{ github.event.pull_request.base.sha }}
          HEAD_SHA=${{ github.event.pull_request.head.sha }}
          
          CHANGED_FILES=$(git diff --name-only $BASE_SHA $HEAD_SHA | wc -l)
          ADDITIONS=$(git diff --numstat $BASE_SHA $HEAD_SHA | awk '{sum+=$1} END {print sum}')
          DELETIONS=$(git diff --numstat $BASE_SHA $HEAD_SHA | awk '{sum+=$2} END {print sum}')
          
          echo "üìä PR Statistics:"
          echo "Files changed: $CHANGED_FILES"
          echo "Lines added: $ADDITIONS"
          echo "Lines deleted: $DELETIONS"
          
          if [ $CHANGED_FILES -gt 50 ]; then
            echo "‚ö†Ô∏è This PR modifies more than 50 files. Consider breaking it into smaller PRs."
          fi
          
          if [ $ADDITIONS -gt 1000 ]; then
            echo "‚ö†Ô∏è This PR adds more than 1000 lines. Consider breaking it into smaller PRs."
          fi
